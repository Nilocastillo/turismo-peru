---
import Layout from "@/layouts/Layout.astro";
---

---

<Layout>
  <div class="max-w-5xl mx-auto px-4 py-10 mt-24 md:mt-48">
    <div class="max-w-5xl mx-auto">
      <!-- Header -->
      <div class="mb-8">
        <h1 class="text-4xl font-bold text-slate-900 mb-2">
          ¿A dónde quieres ir?
        </h1>
      </div>

      <div class="bg-white rounded-3xl p-6 sm:p-8 shadow-lg">
        <form id="flight-form" class="space-y-6">
          <!-- Trip Type & Controls -->
          <div
            class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8"
          >
            <!-- Trip Type Buttons -->
            <div class="flex gap-3">
              <label
                class="flex items-center gap-2 px-4 py-2 rounded-full border-2 border-blue-600 bg-blue-50 cursor-pointer"
              >
                <input
                  type="radio"
                  name="tripType"
                  value="roundtrip"
                  class="w-5 h-5 text-blue-600 cursor-pointer"
                  checked
                />
                <span class="text-sm font-semibold text-slate-800"
                  >Ida y vuelta</span
                >
              </label>
              <label
                class="flex items-center gap-2 px-4 py-2 rounded-full border-2 border-slate-300 bg-white hover:border-slate-400 cursor-pointer transition"
              >
                <input
                  type="radio"
                  name="tripType"
                  value="oneway"
                  class="w-5 h-5 text-blue-600 cursor-pointer"
                />
                <span class="text-sm font-semibold text-slate-700"
                  >Solo ida</span
                >
              </label>
            </div>
          </div>

          <!-- Message -->
          <div id="form-message" class="hidden mx-auto"></div>

          <!-- Origin & Destination -->
          <div
            class="flex-col items-center gap-4 bg-slate-50 p-6 rounded-2xl border-2 border-slate-200"
          >
            <!-- Origen -->
            <div>
              <label
                class="block text-xs font-bold text-slate-600 uppercase mb-2"
                >Desde</label
              >
              <select
                id="origin"
                name="origin"
                required
                class="w-full px-4 py-3 bg-white border-2 border-slate-300 rounded-xl text-slate-800 font-medium focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 appearance-none"
              >
                <option value="">Selecciona origen</option>
                <option value="LIM">Lima (LIM) - Jorge Chávez</option>
                <option value="CUZ"
                  >Cusco (CUZ) - Alejandro Velasco Astete</option
                >
                <option value="AQP">Arequipa (AQP) - Rodríguez Ballón</option>
                <option value="TCQ"
                  >Tacna (TCQ) - Crnl. FAP Carlos Ciriani</option
                >
                <option value="JUL">Juliaca (JUL) - Inca Manco Cápac</option>
                <option value="PIU"
                  >Piura (PIU) - Cap. FAP Guillermo Concha</option
                >
                <option value="TRU"
                  >Trujillo (TRU) - Cap. FAP Carlos Martínez</option
                >
                <option value="IQT"
                  >Iquitos (IQT) - Crnl. FAP Francisco Secada</option
                >
                <option value="TPP"
                  >Tarapoto (TPP) - Cad. FAP Guillermo del Castillo</option
                >
                <option value="PEM"
                  >Puerto Maldonado (PEM) - Padre Aldamiz</option
                >
                <option value="CHM"
                  >Chiclayo (CHM) - Cap. FAP José A. Quiñones</option
                >
                <option value="AYP"
                  >Ayacucho (AYP) - Coronel FAP Alfredo Mendívil</option
                >
                <option value="JAU">Jauja (JAU) - Francisco Carle</option>
                <option value="TBP">Tumbes (TBP) - Cap. FAP Pedro Canga</option>
                <option value="PIO"
                  >Pisco (PIO) - Cap. FAP Renán Elías Olivera</option
                >
              </select>
            </div>
            <!-- Action Buttons -->
            <div class="flex gap-2 items-center justify-center py-4">
              <button
                type="button"
                id="swap-btn"
                class="w-10 h-10 rounded-full border-2 border-red-500 bg-white hover:bg-red-50 flex items-center justify-center transition"
                title="Intercambiar origen y destino"
              >
                <svg
                  class="w-5 h-5 text-red-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                </svg>
              </button>
            </div>

            <!-- Destino -->
            <div>
              <label
                class="block text-xs font-bold text-slate-600 uppercase mb-2"
                >Hacia</label
              >
              <select
                id="destination"
                name="destination"
                required
                class="w-full px-4 py-3 bg-white border-2 border-slate-300 rounded-xl text-slate-800 font-medium focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 appearance-none"
              >
                <option value="">Selecciona destino</option>
                <option value="LIM">Lima (LIM) - Jorge Chávez</option>
                <option value="CUZ"
                  >Cusco (CUZ) - Alejandro Velasco Astete</option
                >
                <option value="AQP">Arequipa (AQP) - Rodríguez Ballón</option>
                <option value="TCQ"
                  >Tacna (TCQ) - Crnl. FAP Carlos Ciriani</option
                >
                <option value="JUL">Juliaca (JUL) - Inca Manco Cápac</option>
                <option value="PIU"
                  >Piura (PIU) - Cap. FAP Guillermo Concha</option
                >
                <option value="TRU"
                  >Trujillo (TRU) - Cap. FAP Carlos Martínez</option
                >
                <option value="IQT"
                  >Iquitos (IQT) - Crnl. FAP Francisco Secada</option
                >
                <option value="TPP"
                  >Tarapoto (TPP) - Cad. FAP Guillermo del Castillo</option
                >
                <option value="PEM"
                  >Puerto Maldonado (PEM) - Padre Aldamiz</option
                >
                <option value="CHM"
                  >Chiclayo (CHM) - Cap. FAP José A. Quiñones</option
                >
                <option value="AYP"
                  >Ayacucho (AYP) - Coronel FAP Alfredo Mendívil</option
                >
                <option value="JAU">Jauja (JAU) - Francisco Carle</option>
                <option value="TBP">Tumbes (TBP) - Cap. FAP Pedro Canga</option>
                <option value="PIO"
                  >Pisco (PIO) - Cap. FAP Renán Elías Olivera</option
                >
              </select>
            </div>
          </div>

          <!-- Dates & Cabin -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <!-- Departure Date -->
            <div>
              <label
                class="block text-xs font-bold text-slate-600 uppercase mb-2"
                >Ida</label
              >
              <div class="relative">
                <input
                  type="date"
                  id="departureDate"
                  name="departureDate"
                  required
                  class="w-full px-4 py-3 bg-white border-2 border-slate-300 rounded-xl text-slate-800 font-medium focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200"
                />
              </div>
            </div>

            <!-- Return Date -->
            <div id="returnDateContainer">
              <label
                class="block text-xs font-bold text-slate-600 uppercase mb-2"
                >Vuelta</label
              >
              <div class="relative">
                <input
                  type="date"
                  id="returnDate"
                  name="returnDate"
                  class="w-full px-4 py-3 bg-white border-2 border-slate-300 rounded-xl text-slate-800 font-medium focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200"
                />
              </div>
            </div>
          </div>

          <!-- Passengers -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <!-- Passengers Dropdown -->
            <div class="relative">
              <label
                class="block text-xs font-bold text-slate-600 uppercase mb-2"
                >Pasajeros</label
              >
              <button
                type="button"
                id="passengers-trigger"
                class="w-full px-4 py-3 bg-white border-2 border-slate-300 rounded-xl text-slate-800 font-medium hover:border-blue-500 transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 flex justify-between items-center"
              >
                <span id="passengers-display">1 adulto, 0 niños, 0 bebés</span>
                <svg
                  id="passengers-arrow"
                  class="w-5 h-5 text-slate-400 transition-transform duration-200"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                </svg>
              </button>

              <!-- Passengers Dropdown Menu -->
              <div
                id="passengers-dropdown"
                class="absolute z-20 w-full mt-2 bg-white border-2 border-slate-300 rounded-xl shadow-xl p-4 hidden"
              >
                <div class="space-y-4">
                  <!-- Adults -->
                  <div class="flex justify-between items-center">
                    <div>
                      <div class="font-semibold text-slate-800">Adultos</div>
                      <div class="text-xs text-slate-500">(+12 años)</div>
                    </div>
                    <div class="flex items-center gap-2">
                      <button
                        type="button"
                        data-action="decrease"
                        data-target="adults"
                        class="passenger-btn w-8 h-8 bg-slate-200 text-slate-700 rounded-full flex items-center justify-center hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition"
                        disabled
                      >
                        −
                      </button>
                      <span
                        id="adults-count"
                        class="font-bold w-6 text-center text-slate-800">1</span
                      >
                      <button
                        type="button"
                        data-action="increase"
                        data-target="adults"
                        class="passenger-btn w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition"
                      >
                        +
                      </button>
                      <input
                        type="hidden"
                        name="adults"
                        id="adults-input"
                        value="1"
                      />
                    </div>
                  </div>

                  <!-- Children -->
                  <div class="flex justify-between items-center">
                    <div>
                      <div class="font-semibold text-slate-800">Niños</div>
                      <div class="text-xs text-slate-500">(2-11 años)</div>
                    </div>
                    <div class="flex items-center gap-2">
                      <button
                        type="button"
                        data-action="decrease"
                        data-target="children"
                        class="passenger-btn w-8 h-8 bg-slate-200 text-slate-700 rounded-full flex items-center justify-center hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition"
                        disabled
                      >
                        −
                      </button>
                      <span
                        id="children-count"
                        class="font-bold w-6 text-center text-slate-800">0</span
                      >
                      <button
                        type="button"
                        data-action="increase"
                        data-target="children"
                        class="passenger-btn w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition"
                      >
                        +
                      </button>
                      <input
                        type="hidden"
                        name="children"
                        id="children-input"
                        value="0"
                      />
                    </div>
                  </div>

                  <!-- Infants -->
                  <div class="flex justify-between items-center">
                    <div>
                      <div class="font-semibold text-slate-800">Bebés</div>
                      <div class="text-xs text-slate-500">(0-23 meses)</div>
                    </div>
                    <div class="flex items-center gap-2">
                      <button
                        type="button"
                        data-action="decrease"
                        data-target="infants"
                        class="passenger-btn w-8 h-8 bg-slate-200 text-slate-700 rounded-full flex items-center justify-center hover:bg-slate-300 disabled:opacity-50 disabled:cursor-not-allowed transition"
                        disabled
                      >
                        −
                      </button>
                      <span
                        id="infants-count"
                        class="font-bold w-6 text-center text-slate-800">0</span
                      >
                      <button
                        type="button"
                        data-action="increase"
                        data-target="infants"
                        class="passenger-btn w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition"
                      >
                        +
                      </button>
                      <input
                        type="hidden"
                        name="infants"
                        id="infants-input"
                        value="0"
                      />
                    </div>
                  </div>
                </div>
                <button
                  type="button"
                  id="passengers-apply"
                  class="mt-4 w-full py-2.5 bg-slate-100 text-blue-600 font-bold rounded-lg hover:bg-slate-200 transition"
                >
                  Aplicar
                </button>
              </div>
            </div>
            <!-- Cabin Class -->
            <div>
              <label
                class="block text-xs font-bold text-slate-600 uppercase mb-2"
                >Cabina</label
              >
              <select
                id="cabin"
                name="cabin"
                class="w-full px-4 py-3 bg-white border-2 border-slate-300 rounded-xl text-slate-800 font-medium focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 appearance-none"
              >
                <option value="economy" selected>Economy</option>
                <option value="premium-economy">Premium Economy</option>
                <option value="business">Business</option>
              </select>
            </div>
          </div>
          <!-- Action Buttons -->
          <div
            class="pt-6 border-t-2 border-slate-200 mt-8 flex flex-col sm:flex-row gap-3"
          >
            <button
              type="submit"
              class="flex-1 px-6 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition shadow-md hover:shadow-lg flex items-center justify-center gap-2"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
              Reservar Vuelo
            </button>
            <button
              type="button"
              id="whatsapp-btn"
              class="flex-1 px-6 py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 transition shadow-md hover:shadow-lg flex items-center justify-center gap-2"
            >
              <svg
                class="w-5 h-5"
                fill="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M20.52 3.48A11.84 11.84 0 0012 0C5.37 0 0 5.37 0 12c0 2.12.55 4.1 1.52 5.88L0 24l6.24-1.56A11.88 11.88 0 0012 24c6.63 0 12-5.37 12-12 0-3.18-1.24-6.18-3.48-8.52zm-8.52 17.52a9.87 9.87 0 01-5.16-1.44l-.36-.21-3.72.93.99-3.63-.24-.36a9.84 9.84 0 0115.48-11.88 9.84 9.84 0 01-6.99 16.59zm5.04-7.92c-.27-.14-1.62-.81-1.86-.9-.24-.09-.42-.14-.6.14s-.69.9-.84 1.08c-.15.18-.3.21-.57.07-.27-.14-1.14-.42-2.16-1.32-.8-.71-1.34-1.59-1.5-1.86-.15-.27-.02-.42.12-.56.12-.12.27-.3.42-.45.15-.15.2-.27.3-.45.09-.18.05-.34-.02-.48-.07-.14-.6-1.44-.82-1.96-.22-.51-.44-.44-.6-.45-.15 0-.33-.02-.51-.02s-.48.07-.73.36c-.24.29-.96.94-.96 2.28 0 1.34.99 2.64 1.13 2.82.14.18 1.94 2.96 4.7 4.15.66.28 1.18.45 1.58.58.66.21 1.26.18 1.74.11.53-.08 1.62-.66 1.85-1.29.22-.63.22-1.17.15-1.29-.07-.12-.24-.18-.51-.32z"
                ></path>
              </svg>
              Solicitar vuelo por WhatsApp
            </button>
          </div>
        </form>
      </div>

      <style>
        /* Estilos personalizados */
        select {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236B7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
          background-repeat: no-repeat;
          background-position: right 0.75rem center;
          padding-right: 2.5rem;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }

        input[type="number"] {
          -moz-appearance: textfield;
        }
      </style>

      <!-- ... existing script code from original component ... -->
      <script is:inline>
        // (Your existing JavaScript code remains exactly the same)
        const tripTypeInputs = document.querySelectorAll(
          'input[name="tripType"]'
        );
        const returnDateInput = document.getElementById("returnDate");
        const returnDateContainer = document.getElementById(
          "returnDateContainer"
        );
        const swapBtn = document.getElementById("swap-btn");
        const originSelect = document.getElementById("origin");
        const destinationSelect = document.getElementById("destination");
        const passengersTrigger = document.getElementById("passengers-trigger");
        const passengersDropdown = document.getElementById(
          "passengers-dropdown"
        );
        const passengersApply = document.getElementById("passengers-apply");
        const passengersDisplay = document.getElementById("passengers-display");
        const passengersArrow = document.getElementById("passengers-arrow");
        const whatsappBtn = document.getElementById("whatsapp-btn");
        const form = document.getElementById("flight-form");
        const formMessage = document.getElementById("form-message");

        const passengerCounts = { adults: 1, children: 0, infants: 0 };

        function updatePassengersDisplay() {
          const { adults, children, infants } = passengerCounts;
          const parts = [];
          parts.push(`${adults} adulto${adults !== 1 ? "s" : ""}`);
          if (children > 0)
            parts.push(`${children} niño${children !== 1 ? "s" : ""}`);
          if (infants > 0)
            parts.push(`${infants} bebé${infants !== 1 ? "s" : ""}`);
          if (passengersDisplay)
            passengersDisplay.textContent = parts.join(", ");

          document.querySelectorAll(".passenger-btn").forEach((btn) => {
            const action = btn.dataset.action;
            const target = btn.dataset.target;
            if (!target) return;
            const currentCount = passengerCounts[target];
            if (action === "decrease") {
              btn.disabled =
                target === "adults" ? currentCount <= 1 : currentCount <= 0;
            } else if (action === "increase") {
              // No limits based on adults
            }
          });
        }

        function validateDestinations() {
          if (!originSelect || !destinationSelect) return;
          if (
            originSelect.value &&
            destinationSelect.value &&
            originSelect.value === destinationSelect.value
          ) {
            if (formMessage) {
              formMessage.className =
                "mx-auto mb-6 p-4 rounded-xl text-sm font-medium bg-amber-50 text-amber-700 border border-amber-200";
              formMessage.textContent =
                "⚠️ El origen y el destino no pueden ser el mismo.";
              formMessage.classList.remove("hidden");
              setTimeout(() => formMessage.classList.add("hidden"), 5000);
            }
            destinationSelect.value = "";
          }
        }

        tripTypeInputs.forEach((input) => {
          input.addEventListener("change", (e) => {
            if (e.target.value === "oneway") {
              returnDateInput.disabled = true;
              returnDateInput.value = "";
              returnDateContainer?.classList.add("opacity-40");
            } else {
              returnDateInput.disabled = false;
              returnDateContainer?.classList.remove("opacity-40");
            }
          });
        });

        swapBtn?.addEventListener("click", () => {
          if (!originSelect || !destinationSelect) return;
          const temp = originSelect.value;
          originSelect.value = destinationSelect.value;
          destinationSelect.value = temp;
          validateDestinations();
        });

        passengersTrigger?.addEventListener("click", () => {
          passengersDropdown?.classList.toggle("hidden");
          passengersArrow?.classList.toggle("rotate-180");
        });

        document.addEventListener("click", (e) => {
          if (
            !passengersTrigger?.contains(e.target) &&
            !passengersDropdown?.contains(e.target)
          ) {
            passengersDropdown?.classList.add("hidden");
            passengersArrow?.classList.remove("rotate-180");
          }
        });

        passengersApply?.addEventListener("click", () => {
          passengersDropdown?.classList.add("hidden");
          passengersArrow?.classList.remove("rotate-180");
        });

        document.querySelectorAll(".passenger-btn").forEach((button) => {
          button.addEventListener("click", (e) => {
            const btn = e.currentTarget;
            const action = btn.dataset.action;
            const target = btn.dataset.target;
            if (!target) return;

            if (action === "increase") {
              if (
                target === "adults" ||
                target === "children" ||
                target === "infants"
              ) {
                passengerCounts[target]++;
              }
            } else if (action === "decrease") {
              if (target !== "adults" && passengerCounts[target] > 0) {
                passengerCounts[target]--;
              } else if (target === "adults" && passengerCounts[target] > 1) {
                passengerCounts[target]--;
              } else if (target === "adults" && passengerCounts[target] > 1) {
                passengerCounts[target]--;
              }
            }

            const countElement = document.getElementById(`${target}-count`);
            const inputElement = document.getElementById(`${target}-input`);
            if (countElement)
              countElement.textContent = passengerCounts[target].toString();
            if (inputElement)
              inputElement.value = passengerCounts[target].toString();
            updatePassengersDisplay();
          });
        });

        const today = new Date().toISOString().split("T")[0];
        const departureDateInput = document.getElementById("departureDate");
        if (departureDateInput) departureDateInput.min = today;
        if (returnDateInput) returnDateInput.min = today;

        departureDateInput?.addEventListener("change", () => {
          if (returnDateInput) {
            returnDateInput.min = departureDateInput.value;
            if (
              returnDateInput.value &&
              returnDateInput.value < departureDateInput.value
            ) {
              returnDateInput.value = "";
            }
          }
        });

        originSelect?.addEventListener("change", validateDestinations);
        destinationSelect?.addEventListener("change", validateDestinations);

        form?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(form);
          try {
            const response = await fetch(
              "https://formspree.io/f/TU_ID_FORMSPREE",
              {
                method: "POST",
                body: formData,
                headers: { Accept: "application/json" },
              }
            );
            if (response.ok) {
              if (formMessage) {
                formMessage.className =
                  "mx-auto mb-6 p-4 rounded-xl text-sm font-medium bg-green-50 text-green-700 border border-green-200";
                formMessage.textContent =
                  "✅ Solicitud enviada correctamente. ¡Pronto te contactaremos!";
                formMessage.classList.remove("hidden");
              }
              form.reset();
              passengerCounts.adults = 1;
              passengerCounts.children = 0;
              passengerCounts.infants = 0;
              document.getElementById("adults-count").textContent = "1";
              document.getElementById("children-count").textContent = "0";
              document.getElementById("infants-count").textContent = "0";
              updatePassengersDisplay();
            } else {
              throw new Error("Error");
            }
          } catch (error) {
            if (formMessage) {
              formMessage.className =
                "mx-auto mb-6 p-4 rounded-xl text-sm font-medium bg-red-50 text-red-700 border border-red-200";
              formMessage.textContent =
                "❌ Error al enviar. Por favor, intenta de nuevo o usa WhatsApp.";
              formMessage.classList.remove("hidden");
            }
          }
          setTimeout(() => formMessage?.classList.add("hidden"), 5000);
        });

        whatsappBtn?.addEventListener("click", () => {
          if (!form || !originSelect || !destinationSelect) return;
          const formData = new FormData(form);
          const origin = formData.get("origin");
          const destination = formData.get("destination");
          const departureDate = formData.get("departureDate");

          if (!origin || !destination || !departureDate) {
            if (formMessage) {
              formMessage.className =
                "mx-auto mb-6 p-4 rounded-xl text-sm font-medium bg-amber-50 text-amber-700 border border-amber-200";
              formMessage.textContent =
                "⚠️ Completa los campos Origen, Destino y Fecha de Salida.";
              formMessage.classList.remove("hidden");
              setTimeout(() => formMessage.classList.add("hidden"), 5000);
            }
            return;
          }

          const tripType = formData.get("tripType");
          const returnDate = formData.get("returnDate");
          const adults = formData.get("adults");
          const children = formData.get("children");
          const infants = formData.get("infants");
          const cabin = formData.get("cabin");
          const originText =
            originSelect.options[originSelect.selectedIndex].text;
          const destinationText =
            destinationSelect.options[destinationSelect.selectedIndex].text;
          let cabinText = "Economy";
          if (cabin === "premium-economy") cabinText = "Premium Economy";
          if (cabin === "business") cabinText = "Business";

          const formatDate = (dateStr) => {
            if (!dateStr) return "";
            try {
              const dateParts = dateStr.split("-");
              const dateObj = new Date(
                dateParts[0],
                dateParts[1] - 1,
                dateParts[2]
              );
              return dateObj.toLocaleDateString("es-PE", {
                day: "numeric",
                month: "long",
                year: "numeric",
              });
            } catch (e) {
              return dateStr;
            }
          };

          let message = `*SOLICITUD DE RESERVA DE VUELO*\n\n`;
          message += `*Tipo:* ${tripType === "roundtrip" ? "Ida y vuelta" : "Solo ida"}\n`;
          message += `*Origen:* ${originText}\n`;
          message += `*Destino:* ${destinationText}\n`;
          message += `*Salida:* ${formatDate(departureDate)}\n`;
          if (tripType === "roundtrip" && returnDate)
            message += `*Regreso:* ${formatDate(returnDate)}\n`;
          message += `\n*Pasajeros:*\n- Adultos: ${adults}\n`;
          if (parseInt(children) > 0) message += `- Niños: ${children}\n`;
          if (parseInt(infants) > 0) message += `- Bebés: ${infants}\n`;
          message += `\n*Clase:* ${cabinText}`;
          message += `\n\n_Por favor, confírmame tu nombre completo para continuar la cotización._`;

          const encodedMessage = encodeURIComponent(message);
          const whatsappURL = `https://api.whatsapp.com/send?phone=51950311111&text=${encodedMessage}`;
          window.open(whatsappURL, "_blank");
        });

        updatePassengersDisplay();
      </script>
    </div>
  </div></Layout
>
